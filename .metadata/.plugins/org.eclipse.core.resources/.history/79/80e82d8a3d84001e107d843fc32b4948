package packagee11_Stacks;

import java.util.Stack;

public class P3_Decode_a_String {
	
	public static String decode(String str) {
		
		Stack<Object> st = new Stack<>();
		
		for(char c: str.toCharArray()) {
			
			if(c != ']') {
				st.push(c);
			}else {
				
				String currVal = "";
				while(!st.isEmpty() && st.peek() instanceof Character && (char)  st.peek() != '[') {
					currVal =  st.pop()+currVal;
				}
				st.pop();
				
				// find the number
				StringBuilder number = new StringBuilder();
				while(!st.isEmpty() && st.peek() instanceof Character &&  Character.isDigit((char)  st.peek() )) {
					number.append(st.pop());
				}
				
				Integer count = Integer.parseInt(number.toString());
				StringBuilder currValrepeated = new StringBuilder("");
				for(int i=0;i<count;i++) {
					currValrepeated.append(currVal);
				}
				
				st.push(currValrepeated.toString());
			}
			
		}
		
		
		
		StringBuilder result = new StringBuilder("");
		for(Object obj : st) {
			
			if(obj instanceof Character) {
				result.append((char) obj);
			}else if(obj instanceof String) {
				result.append((String) obj);
			}
			
		}
		
		return result.toString();
	}
	
	
	public static String decodeString(String s) {
        Stack<Object> stack = new Stack<>();

        for (char c : s.toCharArray()) {
            if (c != ']') {
                stack.push(c);
            } else {
                StringBuilder subStr = new StringBuilder();
                while (!stack.isEmpty() && stack.peek() instanceof Character && (char) stack.peek() != '[') {
                    subStr.insert(0, stack.pop());
                }
                stack.pop(); // Pop the '['

                StringBuilder multiplier = new StringBuilder();
                while (!stack.isEmpty() && stack.peek() instanceof Character && Character.isDigit((char) stack.peek())) {
                    multiplier.insert(0, stack.pop());
                }

                int count = Integer.parseInt(multiplier.toString());
                StringBuilder repeatedStr = new StringBuilder();
                for (int i = 0; i < count; i++) {
                    repeatedStr.append(subStr);
                }

                stack.push(repeatedStr.toString());
            }
        }

        StringBuilder result = new StringBuilder();
        for (Object obj : stack) {
            if (obj instanceof Character) {
                result.append(obj);
            } else if (obj instanceof String) {
                result.append((String) obj);
            }
        }

        return result.toString();
    }

	public static void main(String[] args) {
		
		String encodedStr = "3[ab2[cv]]";
		
		String decodedStr = decode(encodedStr);
		
		System.out.println(decodedStr);

	}

}
